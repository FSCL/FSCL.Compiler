<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Compiler Configuration
</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="F# to OpenCL compiler" />
    <meta name="author" content="Gabriele Cocco" />
    <script type="text/javascript" src="javascripts/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("table.pre").wrap("<div class='code-container'></div>");
            $("table.pre").css("width", ($("section").width() - 30) + "px");
            $("pre.fssnip").css("width", ($("section").width() - 30) + "px");
            $(window).resize(function () {
                $("table.pre").css("width", ($("section").width() - 30) + "px");
                $("pre.fssnip").css("width", ($("section").width() - 30) + "px");
            });
        });
    </script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="wrapper">
        <header>
            <div class="header-container">
                <h1>FSCL.Compiler</h1>
                <p>F# to OpenCL compiler</p>
            </div>
            <table class="git-links">
                <tr>
                    <td><a href="https://github.com/FSCL/FSCL.Runtime/zipball/master">Download <strong>ZIP File</strong></a></td>
                    <td><a href="https://github.com/FSCL/FSCL.Runtime/tarball/master">Download <strong>TAR Ball</strong></a></td>
                    <td><a href="http://github.com/FSCL/FSCL.Runtime/master">Fork On <strong>GitHub</strong></a></td>
                </tr>
            </table>
        </header>
        <section>
            
<h1>Compiler Configuration</h1>

<p>The FSCL compiler pipeline is composed of a set of steps that progressively transform F# expressions into OpenCL code.
Even if the compiler is thought to work straight out-of-the-box by simply instantiating it using the parameterless constructor <code>new Compiler()</code>,
the pipeline can be fully changed and customised as needed.
In this page we give an overview on how the compiler pipeline configuration works.</p>

<h3>Steps, processors and type managers</h3>

<p>Before digging into the configuration infrastructure, a small introduction and a little terminology is needed.
There are three types of <em>components</em> that contribute to the compiler behavior.</p>

<ul>
<li><strong>Steps</strong>: a step is a stage of the compiler pipeline. Generally, the step is logically represents a particular 
transformation or processing</li>
<li><strong>Processors</strong>: each step of the pipeline is made of one or more processors, each of which is contributing to realize
a particular subset of the whole funcionality of the step</li>
<li><strong>Type handlers</strong>: a type handler is resposible to validate and generate the target representation of types</li>
</ul>

<p>For example, the <em>parsing step</em> (or parser) is the first step of the native pipeline whose task is to extract/create a <code>MethodInfo</code> for the
kernel and to determine the set of kernel parameters starting from a quoted expression.
To do this, the parser orchestrates a set of processors, each of which is responsible of parsing a particular quoted
construct, such as kernel calls, kernel references and collection function (e.g. <code>Array.map</code>) calls.</p>

<p>An example of type handler is the <em>Array type handler</em>, whose purpose is to determine is a particular array type is
valid and to generate the target code (e.g. <code>float*</code>) from the .NET type (e.g. <code>float32[]</code>).</p>

<p>Steps, processors and type handlers are characterised by some properties that allow to determine their interrelated order
of execution.
For example, each step is decribed by:</p>

<ul>
<li><strong>ID</strong>: the step unique string identifier</li>
<li><strong>Dependencies</strong>: the list of IDs of steps that should execute before the current one</li>
<li><strong>Before</strong>: the list of IDs of steps that should execute after the current one</li>
</ul>

<p>Processors and type handlers have the same set of properties. In addition, each processor has a <em>Step</em> property that holds the ID of the
step the processor belongs to.
Having both <em>dependencies</em> and <em>before</em> may sound redundant, but it comes in handy whenever various dlls containing components 
(generally called <em>plugins</em> ) are published, shared and used in different environments.
In fact, plugin developers cannot take into account all the past, present and future components that may populate
the compiler pipeline in the target environment.
Given this, developers generally specify only the dependencies of custom components from the native compiler components.
Sometimes it happens that two plugins (potentially from different authors) cannot be evaluated in arbitrary order, but instead
have an inter-dependency. For example, a programmer may create a custom step that converts objects into structs to be plugged into a pipeline
already containing another custom step that performs some optimisations on structs. Since the programmer cannot modify the pre-existing custom step
(it's a dll placed somewhere), he will add the ID of the structs-optimisation step to the <em>Before</em> list of the step he's developing to guarantee
the pre-existing step is executed only after his one.</p>

<h3>Native configuration</h3>

<p>Whenever you instantiate the compiler using the parameterless constructor, the pipeline is populated with the native, built-in FSCL compiler components (which, by the way, are contained in the <code>FSCL.Compiler.NativeComponents.dll</code> library).</p>

<h3>Custom configuration</h3>

<p>There are mainly three aspects to consider when configuring the compiler pipeline:</p>

<ul>
<li><strong>Component source</strong>: the compiler configuration is specified as a set of compoents containers (or sources), from which to load the 
steps, processors and type handlers that will form the pipeline. There are two kinds of components sources:
<ul>
<li><strong>File source</strong>: a (string) path to a dll</li>
<li><strong>Assembly source</strong>: an <code>Assembly</code> object</li>
</ul></li>
<li><strong>Loading mode</strong>: the loading mode determines the way a components source is inspected to find compiler components. There are two kinds of loading modes:
<ul>
<li><strong>Automatic loading mode</strong>: each compiler component is marked with a custom attribute reporting the type of component (step, processor, etc.), the ID and the dependencies/before list. 
The configuration system is inspecting the set of types declared in the dll/assembly and extract all the types marked with that specific custom attribute.</li>
<li><strong>Explicit loading mode</strong>: the user has to explicitely tell the set of types (together with the ID, the dependencies, etc.) contained in the source that should
be loaded as compiler components</li>
</ul></li>
<li><strong>Configuration mode</strong>: the configuration mode tells which kind on object you use to represent the pipeline configuration. It can be:
<ul>
<li><strong>Object-based</strong>: you use an object of type <code>PipelineConfiguration</code>, containing the list of components sources to consider</li>
<li><strong>File-based</strong>: you specify the path to an XML file that describes the pipeline configuration</li>
</ul></li>
</ul>

<p>In a prototyping environment, object-base configuration, assembly source and automatic loading mode is the suggested combination, since makes it fast to create and change
the configuration.</p>

<p>When moving to a testing/tweaking environment, you may want to play with the order of execution of come steps or try to disable/enable some processors for sake of performance.
This is a case where object-based configuration and assembly sources are still the best choice, but automatic locading mode is not anymore, cause changing inter-dependencies or
enabling-disabling a components with such a loading mode requires to change/add/remove components custom attributes (and recompile the components library).
Therefore, you should go for explicit loading mode, that allows you to perform some changes in the compiler pipeline without the need to touch your components code.</p>

<p>Finally, in a production environment you'll very likely store the dlls containing your components somewhere and you won't touch the
compiler instantiation anymore (you may have some production code using the FSCL compiler that you don't want to change, recompile and redeploy).
This is the perfect situation to use file sources and file-based configurations.
For example, consider that you create an appplication that uses the FSCL compiler. After proper testing and before deploying, you create a configuration file, you store it somewhere,
and you change the compiler constructor used in your application from the one taking a list of assemblies to one taking a file path (a.k.a. you move from object-based configuration to file-based).
From this moment on, every change to the compiler pipeline (e.g. fixing a bug in a step, adding a custom step, change some order of execution) can be done without the need to
change your application but instead working on the configuration file only.</p>

<h3>Prototyping environment: assembly sources and automatic loading</h3>

<p>The following code shows how to configure the compiler using assembly sources and automatic component loading.
The <code>PipelineConfiguration</code> object represents the entire pipeline configuration. In this particular case, we instantiate
it passing a list of <code>AssemblySource</code>, one of each different assembly containing components that we want to add to the pipeline (most of the time you have one only assembly containing all the components of your plugin).
The first bool value is used to tell the configuration whether the native steps have to be loaded together we the ones specified.
If you build a plugin you generally want to insert it in the default pipeline, so the first argument will be <code>true</code>. If you pass <code>false</code>, you're creating the pipeline from scratch.</p>

<p>With the configuration shown, the configuration system automatically loads the components from the specified assemblies, establishes the execution order based on inter-dependencies, and finally builds a ready-to-use instance of the FSCL compiler.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">IO</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">FSCL</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">FSCL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="i">Compiler</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="i">FSCL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">Compiler</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 9)" onmouseover="showTip(event, 'fs5', 9)" class="i">Configuration</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="i">simpleConf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">PipelineConfiguration</span>(<span class="k">true</span>, <span class="c">// true = Load native components</span>
                                        [|
                                        <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">SourceConfiguration</span>(
                                            <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">AssemblySource</span>(<span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="i">MyCustomStepInAnAssembly</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Assembly</span>));
                                        <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">SourceConfiguration</span>(
                                            <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="i">AssemblySource</span>(<span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="i">MyCustomProcessorInAnotherAssembly</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Assembly</span>));
                                        |])
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">compilerWithSimpleConf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="i">Compiler</span>(<span onmouseout="hideTip(event, 'fs6', 22)" onmouseover="showTip(event, 'fs6', 22)" class="i">simpleConf</span>)</pre>
</td>
</tr>
</table>

<p>Every source can be configured independently from each other, so if you wanted to load some components from a file you could
change an assembly source to file source. For example, in the fillowing code the first source is changed from assembly to file.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="i">simpleConfWithAFileSource</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 24)" onmouseover="showTip(event, 'fs7', 24)" class="i">PipelineConfiguration</span>(<span class="k">true</span>, <span class="c">// true = Load native components</span>
                                                        [|
                                                        <span onmouseout="hideTip(event, 'fs8', 25)" onmouseover="showTip(event, 'fs8', 25)" class="i">SourceConfiguration</span>(
                                                            <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="i">FileSource</span>(<span class="s">&quot;</span><span class="s">MyCustomComponentContainer</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>));
                                                        <span onmouseout="hideTip(event, 'fs8', 27)" onmouseover="showTip(event, 'fs8', 27)" class="i">SourceConfiguration</span>(
                                                            <span onmouseout="hideTip(event, 'fs9', 28)" onmouseover="showTip(event, 'fs9', 28)" class="i">AssemblySource</span>(<span onmouseout="hideTip(event, 'fs10', 29)" onmouseover="showTip(event, 'fs10', 29)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 30)" onmouseover="showTip(event, 'fs12', 30)" class="i">MyCustomProcessorInAnotherAssembly</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Assembly</span>));
                                                        |])
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 31)" onmouseover="showTip(event, 'fs17', 31)" class="i">compilerWithFileSource</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 32)" onmouseover="showTip(event, 'fs14', 32)" class="i">Compiler</span>(<span onmouseout="hideTip(event, 'fs15', 33)" onmouseover="showTip(event, 'fs15', 33)" class="i">simpleConfWithAFileSource</span>)</pre>
</td>
</tr>
</table>

<h3>Testing and tweaking environment: assembly sources and explicit loading</h3>

<p>Let's consider we have the two components sources of the previous example, each of which is containing a step, and we want to test if performances or correctness change
if we switch the order of execution.
Instead of changing the custom attributes marking the steps in the two libraries we can explicitely set (override) the attributes of the steps
in the configuration object.</p>

<p>In the following example we use explicit components loading to load these two steps, where the first (MY<em>CUSTOM</em>STEP<em>A) must be executed after (depends on) the second (MY</em>CUSTOM<em>STEP</em>B).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="i">explicitConf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 35)" onmouseover="showTip(event, 'fs7', 35)" class="i">PipelineConfiguration</span>(<span class="k">true</span>,
                                            [|
                                            <span onmouseout="hideTip(event, 'fs8', 36)" onmouseover="showTip(event, 'fs8', 36)" class="i">SourceConfiguration</span>(                                                            
                                                <span onmouseout="hideTip(event, 'fs16', 37)" onmouseover="showTip(event, 'fs16', 37)" class="i">FileSource</span>(<span class="s">&quot;</span><span class="s">MyCustomComponentContainer</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>),                    
                                                [||], <span class="c">// No type handlers                                                            </span>
                                                [| <span onmouseout="hideTip(event, 'fs19', 38)" onmouseover="showTip(event, 'fs19', 38)" class="i">StepConfiguration</span>(<span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_A</span><span class="s">&quot;</span>, <span class="c">// ID                         </span>
                                                                    <span onmouseout="hideTip(event, 'fs10', 39)" onmouseover="showTip(event, 'fs10', 39)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 40)" onmouseover="showTip(event, 'fs20', 40)" class="i">MyCustomStepA</span><span class="o">&gt;</span>, <span class="c">// Object type</span>
                                                                    [| <span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_B</span><span class="s">&quot;</span> |]) |], <span class="c">// Depends on B</span>
                                                [||] <span class="c">// No processors</span>
                                                );
                                                
                                            <span onmouseout="hideTip(event, 'fs8', 41)" onmouseover="showTip(event, 'fs8', 41)" class="i">SourceConfiguration</span>(                                                            
                                                <span onmouseout="hideTip(event, 'fs9', 42)" onmouseover="showTip(event, 'fs9', 42)" class="i">AssemblySource</span>(<span onmouseout="hideTip(event, 'fs10', 43)" onmouseover="showTip(event, 'fs10', 43)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 44)" onmouseover="showTip(event, 'fs12', 44)" class="i">MyCustomProcessorInAnotherAssembly</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Assembly</span>),                    
                                                [||], <span class="c">// No type handlers                                                            </span>
                                                [| <span onmouseout="hideTip(event, 'fs19', 45)" onmouseover="showTip(event, 'fs19', 45)" class="i">StepConfiguration</span>(<span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_B</span><span class="s">&quot;</span>, <span class="c">// ID                         </span>
                                                                     <span onmouseout="hideTip(event, 'fs10', 46)" onmouseover="showTip(event, 'fs10', 46)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs21', 47)" onmouseover="showTip(event, 'fs21', 47)" class="i">MyCustomStepB</span><span class="o">&gt;</span>) |], <span class="c">// Object type</span>
                                                [||] <span class="c">// No processors</span>
                                                );
                                            |])
                                              
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 48)" onmouseover="showTip(event, 'fs22', 48)" class="i">compilerStepAAfterB</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 49)" onmouseover="showTip(event, 'fs14', 49)" class="i">Compiler</span>(<span onmouseout="hideTip(event, 'fs18', 50)" onmouseover="showTip(event, 'fs18', 50)" class="i">explicitConf</span>)
    </pre>
</td>
</tr>
</table>

<p>To change the order of execution of the two steps, you can change the inter-dependency so that the second is 
depending from the first, as shown below.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 51)" onmouseover="showTip(event, 'fs23', 51)" class="i">explicitConfDiffOrder</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 52)" onmouseover="showTip(event, 'fs7', 52)" class="i">PipelineConfiguration</span>(<span class="k">true</span>,
                                                [|
                                                <span onmouseout="hideTip(event, 'fs8', 53)" onmouseover="showTip(event, 'fs8', 53)" class="i">SourceConfiguration</span>(                                                            
                                                    <span onmouseout="hideTip(event, 'fs16', 54)" onmouseover="showTip(event, 'fs16', 54)" class="i">FileSource</span>(<span class="s">&quot;</span><span class="s">MyCustomComponentContainer</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>),                    
                                                    [||], <span class="c">// No type handlers                                                            </span>
                                                    [| <span onmouseout="hideTip(event, 'fs19', 55)" onmouseover="showTip(event, 'fs19', 55)" class="i">StepConfiguration</span>(<span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_A</span><span class="s">&quot;</span>, <span class="c">// ID                         </span>
                                                                        <span onmouseout="hideTip(event, 'fs10', 56)" onmouseover="showTip(event, 'fs10', 56)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 57)" onmouseover="showTip(event, 'fs20', 57)" class="i">MyCustomStepA</span><span class="o">&gt;</span>) |], <span class="c">// Object type</span>
                                                    [||] <span class="c">// No processors</span>
                                                    );
                                                
                                                <span onmouseout="hideTip(event, 'fs8', 58)" onmouseover="showTip(event, 'fs8', 58)" class="i">SourceConfiguration</span>(                                                            
                                                    <span onmouseout="hideTip(event, 'fs9', 59)" onmouseover="showTip(event, 'fs9', 59)" class="i">AssemblySource</span>(<span onmouseout="hideTip(event, 'fs10', 60)" onmouseover="showTip(event, 'fs10', 60)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 61)" onmouseover="showTip(event, 'fs12', 61)" class="i">MyCustomProcessorInAnotherAssembly</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Assembly</span>),                    
                                                    [||], <span class="c">// No type handlers                                                            </span>
                                                    [| <span onmouseout="hideTip(event, 'fs19', 62)" onmouseover="showTip(event, 'fs19', 62)" class="i">StepConfiguration</span>(<span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_B</span><span class="s">&quot;</span>, <span class="c">// ID                         </span>
                                                                         <span onmouseout="hideTip(event, 'fs10', 63)" onmouseover="showTip(event, 'fs10', 63)" class="i">typeof</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs21', 64)" onmouseover="showTip(event, 'fs21', 64)" class="i">MyCustomStepB</span><span class="o">&gt;</span>, <span class="c">// Object type</span>
                                                                         [| <span class="s">&quot;</span><span class="s">MY_CUSTOM_STEP_A</span><span class="s">&quot;</span> |]) |], <span class="c">// Now is B that depends from A</span>
                                                    [||] <span class="c">// No processors</span>
                                                    )
                                                |])
                                              
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 65)" onmouseover="showTip(event, 'fs24', 65)" class="i">compilerStepABeforeB</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 66)" onmouseover="showTip(event, 'fs14', 66)" class="i">Compiler</span>(<span onmouseout="hideTip(event, 'fs23', 67)" onmouseover="showTip(event, 'fs23', 67)" class="i">explicitConfDiffOrder</span>)</pre>
</td>
</tr>
</table>

<h3>Production environment: file sources and configuration file</h3>

<p>In a production environment, you may place the dlls or your custom components in a specific folder and instantiate the compiler
using file sources.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 68)" onmouseover="showTip(event, 'fs25', 68)" class="i">confWithOnlyFileSource</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 69)" onmouseover="showTip(event, 'fs7', 69)" class="i">PipelineConfiguration</span>(<span class="k">false</span>, 
                                                    [|
                                                    <span onmouseout="hideTip(event, 'fs8', 70)" onmouseover="showTip(event, 'fs8', 70)" class="i">SourceConfiguration</span>(
                                                        <span onmouseout="hideTip(event, 'fs16', 71)" onmouseover="showTip(event, 'fs16', 71)" class="i">FileSource</span>(<span onmouseout="hideTip(event, 'fs26', 72)" onmouseover="showTip(event, 'fs26', 72)" class="i">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 73)" onmouseover="showTip(event, 'fs27', 73)" class="i">Combine</span>(
                                                                    <span onmouseout="hideTip(event, 'fs28', 74)" onmouseover="showTip(event, 'fs28', 74)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 75)" onmouseover="showTip(event, 'fs29', 75)" class="i">GetFolderPath</span>(<span onmouseout="hideTip(event, 'fs28', 76)" onmouseover="showTip(event, 'fs28', 76)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 77)" onmouseover="showTip(event, 'fs30', 77)" class="i">SpecialFolder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 78)" onmouseover="showTip(event, 'fs31', 78)" class="i">LocalApplicationData</span>),
                                                                    <span class="s">&quot;</span><span class="s">MyCustomComponentContainerA</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>)));
                                                    <span onmouseout="hideTip(event, 'fs8', 79)" onmouseover="showTip(event, 'fs8', 79)" class="i">SourceConfiguration</span>(
                                                        <span onmouseout="hideTip(event, 'fs16', 80)" onmouseover="showTip(event, 'fs16', 80)" class="i">FileSource</span>(<span onmouseout="hideTip(event, 'fs26', 81)" onmouseover="showTip(event, 'fs26', 81)" class="i">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 82)" onmouseover="showTip(event, 'fs27', 82)" class="i">Combine</span>(
                                                                    <span onmouseout="hideTip(event, 'fs28', 83)" onmouseover="showTip(event, 'fs28', 83)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 84)" onmouseover="showTip(event, 'fs29', 84)" class="i">GetFolderPath</span>(<span onmouseout="hideTip(event, 'fs28', 85)" onmouseover="showTip(event, 'fs28', 85)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 86)" onmouseover="showTip(event, 'fs30', 86)" class="i">SpecialFolder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 87)" onmouseover="showTip(event, 'fs31', 87)" class="i">LocalApplicationData</span>),
                                                                    <span class="s">&quot;</span><span class="s">MyCustomComponentContainerB</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>)))
                                                    |])</pre>
</td>
</tr>
</table>

<p>Every change to the components (e.g. bug fixing) can be performed without the need to change the app that uses the FSCL compiler but simply replacing the dlls in the folder.</p>

<p>The highest flexibility in production is definitely obtained moving from object-based configuration to file-based, that is creating the compiler specifying the path to configuration file
instead of an object. 
A configuration file is an XML file that strictly resebles a <code>PipelineConfiguration</code> object (actually, it's the exact result you obtain by XML marshalling an object of such type).</p>

<p>For example, the configuration of the previous example can be put into the configuration file as follows:
<code>
<?xml version="1.0" encoding="utf-8" ?>
<PipelineConfiguration LoadDefaultSteps="false">
  <Sources>
    <SourceConfiguration FileSource="C:\Documents and Settings\Administrator\Application Data\MyCustomComponentContainerA.dll"/>
    <SourceConfiguration FileSource="C:\Documents and Settings\Administrator\Application Data\MyCustomComponentContainerB.dll"/>
  </Sources><br />
</PipelineConfiguration>
</code></p>

<p>Instead of passing an object to configure the compiler, you can now pass the path to the configuration file.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 88)" onmouseover="showTip(event, 'fs32', 88)" class="i">compilerWithConfFile</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 89)" onmouseover="showTip(event, 'fs14', 89)" class="i">Compiler</span>(<span class="s">&quot;</span><span class="s">MyConfigurationFile</span><span class="s">.</span><span class="s">xml</span><span class="s">&quot;</span>)</pre>
</td>
</tr>
</table>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.IO</div>
<div class="tip" id="fs3">namespace FSCL</div>
<div class="tip" id="fs4">namespace FSCL.Compiler</div>
<div class="tip" id="fs5">namespace FSCL.Compiler.Configuration</div>
<div class="tip" id="fs6">val simpleConf : PipelineConfiguration<br /><br />Full name: CompilerConfigurationTutorial.simpleConf</div>
<div class="tip" id="fs7">Multiple items<br /><br />--------------------<br />new : unit -&gt; PipelineConfiguration<br />new : defSteps:bool -&gt; PipelineConfiguration<br />new : defSteps:bool * sources:SourceConfiguration array -&gt; PipelineConfiguration<br />new : defSteps:bool * steps:ICompilerStep list * handlers:TypeHandler list -&gt; PipelineConfiguration</div>
<div class="tip" id="fs8">Multiple items<br /><br />--------------------<br />new : src:ComponentSource -&gt; SourceConfiguration<br />new : src:ComponentSource * th:TypeHandlerConfiguration array * s:StepConfiguration array * p:StepProcessorConfiguration array -&gt; SourceConfiguration</div>
<div class="tip" id="fs9">union case ComponentSource.AssemblySource: Reflection.Assembly -&gt; ComponentSource</div>
<div class="tip" id="fs10">val typeof&lt;&#39;T&gt; : Type<br /><br />Full name: Microsoft.FSharp.Core.Operators.typeof</div>
<div class="tip" id="fs11">Multiple items<br />type MyCustomStepInAnAssembly =<br />&#160;&#160;inherit Object<br />&#160;&#160;new : unit -&gt; MyCustomStepInAnAssembly<br /><br />Full name: CompilerConfigurationTutorial.MyCustomStepInAnAssembly<br /><br />--------------------<br />new : unit -&gt; MyCustomStepInAnAssembly</div>
<div class="tip" id="fs12">Multiple items<br />type MyCustomProcessorInAnotherAssembly =<br />&#160;&#160;inherit Object<br />&#160;&#160;new : unit -&gt; MyCustomProcessorInAnotherAssembly<br /><br />Full name: CompilerConfigurationTutorial.MyCustomProcessorInAnotherAssembly<br /><br />--------------------<br />new : unit -&gt; MyCustomProcessorInAnotherAssembly</div>
<div class="tip" id="fs13">val compilerWithSimpleConf : Compiler<br /><br />Full name: CompilerConfigurationTutorial.compilerWithSimpleConf</div>
<div class="tip" id="fs14">Multiple items<br />namespace FSCL.Compiler<br /><br />--------------------<br /><br />--------------------<br />new : unit -&gt; Compiler<br />new : file:string -&gt; Compiler<br />new : conf:PipelineConfiguration -&gt; Compiler</div>
<div class="tip" id="fs15">val simpleConfWithAFileSource : PipelineConfiguration<br /><br />Full name: CompilerConfigurationTutorial.simpleConfWithAFileSource</div>
<div class="tip" id="fs16">union case ComponentSource.FileSource: string -&gt; ComponentSource</div>
<div class="tip" id="fs17">val compilerWithFileSource : Compiler<br /><br />Full name: CompilerConfigurationTutorial.compilerWithFileSource</div>
<div class="tip" id="fs18">val explicitConf : PipelineConfiguration<br /><br />Full name: CompilerConfigurationTutorial.explicitConf</div>
<div class="tip" id="fs19">Multiple items<br /><br />--------------------<br />new : unit -&gt; StepConfiguration<br />new : i:string * t:Type * ?dependencies:string array * ?before:string array * ?metadata:(Type * MetadataComparer) array -&gt; StepConfiguration</div>
<div class="tip" id="fs20">Multiple items<br />type MyCustomStepA =<br />&#160;&#160;inherit Object<br />&#160;&#160;new : unit -&gt; MyCustomStepA<br /><br />Full name: CompilerConfigurationTutorial.MyCustomStepA<br /><br />--------------------<br />new : unit -&gt; MyCustomStepA</div>
<div class="tip" id="fs21">Multiple items<br />type MyCustomStepB =<br />&#160;&#160;inherit Object<br />&#160;&#160;new : unit -&gt; MyCustomStepB<br /><br />Full name: CompilerConfigurationTutorial.MyCustomStepB<br /><br />--------------------<br />new : unit -&gt; MyCustomStepB</div>
<div class="tip" id="fs22">val compilerStepAAfterB : Compiler<br /><br />Full name: CompilerConfigurationTutorial.compilerStepAAfterB</div>
<div class="tip" id="fs23">val explicitConfDiffOrder : PipelineConfiguration<br /><br />Full name: CompilerConfigurationTutorial.explicitConfDiffOrder</div>
<div class="tip" id="fs24">val compilerStepABeforeB : Compiler<br /><br />Full name: CompilerConfigurationTutorial.compilerStepABeforeB</div>
<div class="tip" id="fs25">val confWithOnlyFileSource : PipelineConfiguration<br /><br />Full name: CompilerConfigurationTutorial.confWithOnlyFileSource</div>
<div class="tip" id="fs26">type Path =<br />&#160;&#160;static val DirectorySeparatorChar : char<br />&#160;&#160;static val AltDirectorySeparatorChar : char<br />&#160;&#160;static val VolumeSeparatorChar : char<br />&#160;&#160;static val InvalidPathChars : char[]<br />&#160;&#160;static val PathSeparator : char<br />&#160;&#160;static member ChangeExtension : path:string * extension:string -&gt; string<br />&#160;&#160;static member Combine : params paths:string[] -&gt; string + 3 overloads<br />&#160;&#160;static member GetDirectoryName : path:string -&gt; string<br />&#160;&#160;static member GetExtension : path:string -&gt; string<br />&#160;&#160;static member GetFileName : path:string -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.IO.Path</div>
<div class="tip" id="fs27">Path.Combine(params paths: string []) : string<br />Path.Combine(path1: string, path2: string) : string<br />Path.Combine(path1: string, path2: string, path3: string) : string<br />Path.Combine(path1: string, path2: string, path3: string, path4: string) : string</div>
<div class="tip" id="fs28">type Environment =<br />&#160;&#160;static member CommandLine : string<br />&#160;&#160;static member CurrentDirectory : string with get, set<br />&#160;&#160;static member Exit : exitCode:int -&gt; unit<br />&#160;&#160;static member ExitCode : int with get, set<br />&#160;&#160;static member ExpandEnvironmentVariables : name:string -&gt; string<br />&#160;&#160;static member FailFast : message:string -&gt; unit + 1 overload<br />&#160;&#160;static member GetCommandLineArgs : unit -&gt; string[]<br />&#160;&#160;static member GetEnvironmentVariable : variable:string -&gt; string + 1 overload<br />&#160;&#160;static member GetEnvironmentVariables : unit -&gt; IDictionary + 1 overload<br />&#160;&#160;static member GetFolderPath : folder:SpecialFolder -&gt; string + 1 overload<br />&#160;&#160;...<br />&#160;&#160;nested type SpecialFolder<br />&#160;&#160;nested type SpecialFolderOption<br /><br />Full name: System.Environment</div>
<div class="tip" id="fs29">Environment.GetFolderPath(folder: Environment.SpecialFolder) : string<br />Environment.GetFolderPath(folder: Environment.SpecialFolder, option: Environment.SpecialFolderOption) : string</div>
<div class="tip" id="fs30">type SpecialFolder =<br />&#160;&#160;| ApplicationData = 26<br />&#160;&#160;| CommonApplicationData = 35<br />&#160;&#160;| LocalApplicationData = 28<br />&#160;&#160;| Cookies = 33<br />&#160;&#160;| Desktop = 0<br />&#160;&#160;| Favorites = 6<br />&#160;&#160;| History = 34<br />&#160;&#160;| InternetCache = 32<br />&#160;&#160;| Programs = 2<br />&#160;&#160;| MyComputer = 17<br />&#160;&#160;...<br /><br />Full name: System.Environment.SpecialFolder</div>
<div class="tip" id="fs31">field Environment.SpecialFolder.LocalApplicationData = 28</div>
<div class="tip" id="fs32">val compilerWithConfFile : Compiler<br /><br />Full name: CompilerConfigurationTutorial.compilerWithConfFile</div>

        </section>
        <footer>
            <p>This project is maintained by <a href="http://github.com/FSCL">Gabriele Cocco</a></p>
        </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
</body>
</html>
