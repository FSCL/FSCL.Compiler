<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>FSCL Kernel Programming
</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="F# to OpenCL compiler" />
    <meta name="author" content="Gabriele Cocco" />
    <script type="text/javascript" src="javascripts/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("table.pre").wrap("<div class='code-container'></div>");
            $("table.pre").css("width", ($("section").width() - 30) + "px");
            $("pre.fssnip").css("width", ($("section").width() - 30) + "px");
            $(window).resize(function () {
                $("table.pre").css("width", ($("section").width() - 30) + "px");
                $("pre.fssnip").css("width", ($("section").width() - 30) + "px");
            });
        });
    </script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="wrapper">
        <header>
            <div class="header-container">
                <h1><a href="http://fscl.github.io/FSCL.Compiler/">FSCL.Compiler</a></h1>
                <p>F# to OpenCL compiler</p>
            </div>
            <table class="git-links">
                <tr>
                    <td><a href="https://github.com/FSCL/FSCL.Runtime/zipball/master">Download <strong>ZIP File</strong></a></td>
                    <td><a href="https://github.com/FSCL/FSCL.Runtime/tarball/master">Download <strong>TAR Ball</strong></a></td>
                    <td><a href="http://github.com/FSCL/FSCL.Runtime/master">Fork On <strong>GitHub</strong></a></td>
                </tr>
            </table>
        </header>
        <section>
            
<h1>FSCL Kernel Programming</h1>

<p>With the compiler and the object-model provided by the FSCL.Compiler project you can write OpenCL kernels
as F# functions, static/instance methods and lambdas. This page gives an overview on kernel programming in FSCL.</p>

<h3>Basic example: Vector Addition</h3>

<p>The most simple example of kernel programming is very likely parallel vector addition, where each thread (known as work-item in OpenCL)
sums the matching elements of the two input vectors whose index is determined by the thread id.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">FSCL</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">FSCL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">Compiler</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="i">FSCL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">Language</span>

[&lt;<span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">VectorAdd</span>(<span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">a</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 17)" onmouseover="showTip(event, 'fs10', 17)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">c</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="i">myId</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs6', 21)" onmouseover="showTip(event, 'fs6', 21)" class="i">a</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 22)" onmouseover="showTip(event, 'fs12', 22)" class="i">myId</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs8', 23)" onmouseover="showTip(event, 'fs8', 23)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 24)" onmouseover="showTip(event, 'fs12', 24)" class="i">myId</span>]</pre>
</td>
</tr>
</table>

<p>Every FSCL kernel is characterized by an additional parameter of type <code>WorkItemInfo</code> (not necessarily the last one) that is used from within the kernel body
to retrieve all the information related to the work-items space (global/local id of the thread, global/local thread count, work-items space rank, etc.).
In addition, every kernel must be marked with <code>[&lt;ReflectedDefinition&gt;]</code> attribute to enable the compiler to inspect the AST of its body.</p>

<h3>A more complex example: Sobel Filter</h3>

<p>The FSCL compiler library exposes an object-model that allows to write every possible OpenCL kernel in F#. In particular,
all the OpenCL built-in math/vector data/geometric functions are available to be used inside kernels, as like as vector data-types (e.g. float4, int3)
and parameter qualifiers (e.g. __local_, __constant). The <em>Image</em> subset of OpenCL has not been ported to FSCL yet, but it will be very soon.</p>

<p>The following example shows some of these features applied to the Sobel filter algorithm optimised for GPU execution.
In particular, we use vector data-types (<code>float4</code>, <code>uchar4</code>), we perform vector-types conversions (<code>ToFloat4()</code>, <code>ToUChar4()</code>) 
and we use built-in OpenCL math functions, such as <code>float4.hypot()</code>.
An important aspect to note is that the function input are 2D arrays. 
In fact, while in OpenCL C, kernel inputs are restricted to flat 1D arrays, FSCL allows to work with data of type <code>Array2D</code> and <code>Array3D</code>. The compiler
will automatically flat every istance of those types and appropriately manipulate the indexes used to access it.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 25)" onmouseover="showTip(event, 'fs4', 25)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 26)" onmouseover="showTip(event, 'fs14', 26)" class="i">SobelFilter2D</span>(<span onmouseout="hideTip(event, 'fs15', 27)" onmouseover="showTip(event, 'fs15', 27)" class="i">inputImage</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 28)" onmouseover="showTip(event, 'fs16', 28)" class="i">uchar4</span>[,], <span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="i">outputImage</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">uchar4</span>[,], <span onmouseout="hideTip(event, 'fs10', 31)" onmouseover="showTip(event, 'fs10', 31)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 32)" onmouseover="showTip(event, 'fs11', 32)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 33)" onmouseover="showTip(event, 'fs18', 33)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 34)" onmouseover="showTip(event, 'fs10', 34)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 35)" onmouseover="showTip(event, 'fs13', 35)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 37)" onmouseover="showTip(event, 'fs10', 37)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 38)" onmouseover="showTip(event, 'fs13', 38)" class="i">GlobalID</span>(<span class="n">1</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 39)" onmouseover="showTip(event, 'fs20', 39)" class="i">width</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 40)" onmouseover="showTip(event, 'fs10', 40)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 41)" onmouseover="showTip(event, 'fs21', 41)" class="i">GlobalSize</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 42)" onmouseover="showTip(event, 'fs22', 42)" class="i">height</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 43)" onmouseover="showTip(event, 'fs10', 43)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 44)" onmouseover="showTip(event, 'fs21', 44)" class="i">GlobalSize</span>(<span class="n">1</span>)

    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs23', 45)" onmouseover="showTip(event, 'fs23', 45)" class="i">Gx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 46)" onmouseover="showTip(event, 'fs24', 46)" class="i">float4</span>(<span class="n">0.0f</span>)
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs25', 47)" onmouseover="showTip(event, 'fs25', 47)" class="i">Gy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 48)" onmouseover="showTip(event, 'fs23', 48)" class="i">Gx</span>

    <span class="c">// Read each texel component and calculate the filtered value using neighbouring texel components </span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 49)" onmouseover="showTip(event, 'fs26', 49)" class="i">i00</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 50)" onmouseover="showTip(event, 'fs15', 50)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 51)" onmouseover="showTip(event, 'fs19', 51)" class="i">y</span>, <span onmouseout="hideTip(event, 'fs18', 52)" onmouseover="showTip(event, 'fs18', 52)" class="i">x</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 53)" onmouseover="showTip(event, 'fs27', 53)" class="i">i10</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 54)" onmouseover="showTip(event, 'fs15', 54)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 55)" onmouseover="showTip(event, 'fs19', 55)" class="i">y</span>, <span onmouseout="hideTip(event, 'fs18', 56)" onmouseover="showTip(event, 'fs18', 56)" class="i">x</span> <span class="o">+</span> <span class="n">1</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 57)" onmouseover="showTip(event, 'fs28', 57)" class="i">i20</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 58)" onmouseover="showTip(event, 'fs15', 58)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 59)" onmouseover="showTip(event, 'fs19', 59)" class="i">y</span>, <span onmouseout="hideTip(event, 'fs18', 60)" onmouseover="showTip(event, 'fs18', 60)" class="i">x</span> <span class="o">+</span> <span class="n">2</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 61)" onmouseover="showTip(event, 'fs29', 61)" class="i">i01</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 62)" onmouseover="showTip(event, 'fs15', 62)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 63)" onmouseover="showTip(event, 'fs19', 63)" class="i">y</span> <span class="o">+</span> <span class="n">1</span>, <span onmouseout="hideTip(event, 'fs18', 64)" onmouseover="showTip(event, 'fs18', 64)" class="i">x</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 65)" onmouseover="showTip(event, 'fs30', 65)" class="i">i11</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 66)" onmouseover="showTip(event, 'fs15', 66)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 67)" onmouseover="showTip(event, 'fs19', 67)" class="i">y</span> <span class="o">+</span> <span class="n">1</span>, <span onmouseout="hideTip(event, 'fs18', 68)" onmouseover="showTip(event, 'fs18', 68)" class="i">x</span> <span class="o">+</span> <span class="n">1</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 69)" onmouseover="showTip(event, 'fs31', 69)" class="i">i21</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 70)" onmouseover="showTip(event, 'fs15', 70)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 71)" onmouseover="showTip(event, 'fs19', 71)" class="i">y</span> <span class="o">+</span> <span class="n">1</span>, <span onmouseout="hideTip(event, 'fs18', 72)" onmouseover="showTip(event, 'fs18', 72)" class="i">x</span> <span class="o">+</span> <span class="n">2</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 73)" onmouseover="showTip(event, 'fs32', 73)" class="i">i02</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 74)" onmouseover="showTip(event, 'fs15', 74)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 75)" onmouseover="showTip(event, 'fs19', 75)" class="i">y</span> <span class="o">+</span> <span class="n">2</span>, <span onmouseout="hideTip(event, 'fs18', 76)" onmouseover="showTip(event, 'fs18', 76)" class="i">x</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 77)" onmouseover="showTip(event, 'fs33', 77)" class="i">i12</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 78)" onmouseover="showTip(event, 'fs15', 78)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 79)" onmouseover="showTip(event, 'fs19', 79)" class="i">y</span> <span class="o">+</span> <span class="n">2</span>, <span onmouseout="hideTip(event, 'fs18', 80)" onmouseover="showTip(event, 'fs18', 80)" class="i">x</span> <span class="o">+</span> <span class="n">1</span>])<span class="o">.</span><span class="i">ToFloat4</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 81)" onmouseover="showTip(event, 'fs34', 81)" class="i">i22</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs15', 82)" onmouseover="showTip(event, 'fs15', 82)" class="i">inputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 83)" onmouseover="showTip(event, 'fs19', 83)" class="i">y</span> <span class="o">+</span> <span class="n">2</span>, <span onmouseout="hideTip(event, 'fs18', 84)" onmouseover="showTip(event, 'fs18', 84)" class="i">x</span> <span class="o">+</span> <span class="n">2</span>])<span class="o">.</span><span class="i">ToFloat4</span>()

    <span onmouseout="hideTip(event, 'fs23', 85)" onmouseover="showTip(event, 'fs23', 85)" class="i">Gx</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs26', 86)" onmouseover="showTip(event, 'fs26', 86)" class="i">i00</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs24', 87)" onmouseover="showTip(event, 'fs24', 87)" class="i">float4</span>(<span class="n">2.0f</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs27', 88)" onmouseover="showTip(event, 'fs27', 88)" class="i">i10</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs28', 89)" onmouseover="showTip(event, 'fs28', 89)" class="i">i20</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs32', 90)" onmouseover="showTip(event, 'fs32', 90)" class="i">i02</span>  <span class="o">-</span> <span onmouseout="hideTip(event, 'fs24', 91)" onmouseover="showTip(event, 'fs24', 91)" class="i">float4</span>(<span class="n">2.0f</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs33', 92)" onmouseover="showTip(event, 'fs33', 92)" class="i">i12</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs34', 93)" onmouseover="showTip(event, 'fs34', 93)" class="i">i22</span>
    <span onmouseout="hideTip(event, 'fs25', 94)" onmouseover="showTip(event, 'fs25', 94)" class="i">Gy</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs26', 95)" onmouseover="showTip(event, 'fs26', 95)" class="i">i00</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs28', 96)" onmouseover="showTip(event, 'fs28', 96)" class="i">i20</span>  <span class="o">+</span> <span onmouseout="hideTip(event, 'fs24', 97)" onmouseover="showTip(event, 'fs24', 97)" class="i">float4</span>(<span class="n">2.0f</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs29', 98)" onmouseover="showTip(event, 'fs29', 98)" class="i">i01</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs24', 99)" onmouseover="showTip(event, 'fs24', 99)" class="i">float4</span>(<span class="n">2.0f</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs31', 100)" onmouseover="showTip(event, 'fs31', 100)" class="i">i21</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs32', 101)" onmouseover="showTip(event, 'fs32', 101)" class="i">i02</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs34', 102)" onmouseover="showTip(event, 'fs34', 102)" class="i">i22</span>

    <span onmouseout="hideTip(event, 'fs17', 103)" onmouseover="showTip(event, 'fs17', 103)" class="i">outputImage</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs19', 104)" onmouseover="showTip(event, 'fs19', 104)" class="i">y</span>, <span onmouseout="hideTip(event, 'fs18', 105)" onmouseover="showTip(event, 'fs18', 105)" class="i">x</span>] <span class="o">&lt;-</span> (<span onmouseout="hideTip(event, 'fs24', 106)" onmouseover="showTip(event, 'fs24', 106)" class="i">float4</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 107)" onmouseover="showTip(event, 'fs35', 107)" class="i">hypot</span>(<span onmouseout="hideTip(event, 'fs23', 108)" onmouseover="showTip(event, 'fs23', 108)" class="i">Gx</span>, <span onmouseout="hideTip(event, 'fs25', 109)" onmouseover="showTip(event, 'fs25', 109)" class="i">Gy</span>)<span class="o">/</span><span onmouseout="hideTip(event, 'fs24', 110)" onmouseover="showTip(event, 'fs24', 110)" class="i">float4</span>(<span class="n">2.0f</span>))<span class="o">.</span><span class="i">ToUChar4</span>()</pre>
</td>
</tr>
</table>

<h3>Another complex example: Matrix Multiplication</h3>

<p>Matrix multiplication optimised for GPU execution is another example that shows how OpenCL programming
constructs and built-in functions are mapped into F#.
Here, the kernel uses a global property <code>BLOCK_SIZE</code> marked with <code>[&lt;ReflectedDefinition&gt;]</code>. Whenever a kernel
references a reflected property, the compiler produces an appropriate <code>#define</code> in the OpenCL source (in the particular case <code>#define BLOCK_SIZE 16</code>).</p>

<p>The example also shows how to declare <em>local</em> variables (i.e. data shares among the threads in a work group) inside kernels, that is
by wrapping <code>Array.zeroCreate</code> calls in the function <code>local()</code>.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 111)" onmouseover="showTip(event, 'fs4', 111)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 112)" onmouseover="showTip(event, 'fs36', 112)" class="i">BLOCK_SIZE</span> <span class="o">=</span> <span class="n">16</span>
[&lt;<span onmouseout="hideTip(event, 'fs4', 113)" onmouseover="showTip(event, 'fs4', 113)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 114)" onmouseover="showTip(event, 'fs37', 114)" class="i">MatrixMult</span>(<span onmouseout="hideTip(event, 'fs38', 115)" onmouseover="showTip(event, 'fs38', 115)" class="i">matA</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 116)" onmouseover="showTip(event, 'fs7', 116)" class="i">float32</span>[,], <span onmouseout="hideTip(event, 'fs39', 117)" onmouseover="showTip(event, 'fs39', 117)" class="i">matB</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 118)" onmouseover="showTip(event, 'fs7', 118)" class="i">float32</span>[,], <span onmouseout="hideTip(event, 'fs40', 119)" onmouseover="showTip(event, 'fs40', 119)" class="i">matC</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 120)" onmouseover="showTip(event, 'fs7', 120)" class="i">float32</span>[,], <span onmouseout="hideTip(event, 'fs10', 121)" onmouseover="showTip(event, 'fs10', 121)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 122)" onmouseover="showTip(event, 'fs11', 122)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 123)" onmouseover="showTip(event, 'fs41', 123)" class="i">bx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 124)" onmouseover="showTip(event, 'fs10', 124)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 125)" onmouseover="showTip(event, 'fs42', 125)" class="i">GroupID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 126)" onmouseover="showTip(event, 'fs43', 126)" class="i">by</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 127)" onmouseover="showTip(event, 'fs10', 127)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 128)" onmouseover="showTip(event, 'fs42', 128)" class="i">GroupID</span>(<span class="n">1</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 129)" onmouseover="showTip(event, 'fs44', 129)" class="i">tx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 130)" onmouseover="showTip(event, 'fs10', 130)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 131)" onmouseover="showTip(event, 'fs45', 131)" class="i">LocalID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 132)" onmouseover="showTip(event, 'fs46', 132)" class="i">ty</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 133)" onmouseover="showTip(event, 'fs10', 133)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 134)" onmouseover="showTip(event, 'fs45', 134)" class="i">LocalID</span>(<span class="n">1</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 135)" onmouseover="showTip(event, 'fs47', 135)" class="i">wa</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 136)" onmouseover="showTip(event, 'fs38', 136)" class="i">matA</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 137)" onmouseover="showTip(event, 'fs48', 137)" class="i">GetLength</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 138)" onmouseover="showTip(event, 'fs49', 138)" class="i">wb</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 139)" onmouseover="showTip(event, 'fs39', 139)" class="i">matB</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 140)" onmouseover="showTip(event, 'fs48', 140)" class="i">GetLength</span>(<span class="n">0</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 141)" onmouseover="showTip(event, 'fs50', 141)" class="i">bCol</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 142)" onmouseover="showTip(event, 'fs41', 142)" class="i">bx</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 143)" onmouseover="showTip(event, 'fs36', 143)" class="i">BLOCK_SIZE</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 144)" onmouseover="showTip(event, 'fs51', 144)" class="i">bBeginRow</span> <span class="o">=</span> <span class="n">0</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 145)" onmouseover="showTip(event, 'fs52', 145)" class="i">bStep</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 146)" onmouseover="showTip(event, 'fs36', 146)" class="i">BLOCK_SIZE</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs53', 147)" onmouseover="showTip(event, 'fs53', 147)" class="i">bRow</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs51', 148)" onmouseover="showTip(event, 'fs51', 148)" class="i">bBeginRow</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs54', 149)" onmouseover="showTip(event, 'fs54', 149)" class="i">Csub</span> <span class="o">=</span> <span class="n">0.0f</span>
 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 150)" onmouseover="showTip(event, 'fs55', 150)" class="i">As</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs56', 151)" onmouseover="showTip(event, 'fs56', 151)" class="i">local</span>(<span onmouseout="hideTip(event, 'fs57', 152)" onmouseover="showTip(event, 'fs57', 152)" class="i">Array2D</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 153)" onmouseover="showTip(event, 'fs58', 153)" class="i">zeroCreate</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs7', 154)" onmouseover="showTip(event, 'fs7', 154)" class="i">float32</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs36', 155)" onmouseover="showTip(event, 'fs36', 155)" class="i">BLOCK_SIZE</span> <span onmouseout="hideTip(event, 'fs36', 156)" onmouseover="showTip(event, 'fs36', 156)" class="i">BLOCK_SIZE</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 157)" onmouseover="showTip(event, 'fs59', 157)" class="i">Bs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs56', 158)" onmouseover="showTip(event, 'fs56', 158)" class="i">local</span>(<span onmouseout="hideTip(event, 'fs57', 159)" onmouseover="showTip(event, 'fs57', 159)" class="i">Array2D</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 160)" onmouseover="showTip(event, 'fs58', 160)" class="i">zeroCreate</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs7', 161)" onmouseover="showTip(event, 'fs7', 161)" class="i">float32</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs36', 162)" onmouseover="showTip(event, 'fs36', 162)" class="i">BLOCK_SIZE</span> <span onmouseout="hideTip(event, 'fs36', 163)" onmouseover="showTip(event, 'fs36', 163)" class="i">BLOCK_SIZE</span>)

    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs60', 164)" onmouseover="showTip(event, 'fs60', 164)" class="i">aCol</span> <span class="k">in</span> <span class="n">0</span> <span class="o">..</span> <span onmouseout="hideTip(event, 'fs36', 165)" onmouseover="showTip(event, 'fs36', 165)" class="i">BLOCK_SIZE</span> <span class="o">..</span> (<span onmouseout="hideTip(event, 'fs47', 166)" onmouseover="showTip(event, 'fs47', 166)" class="i">wa</span> <span class="o">-</span> <span class="n">1</span>) <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs55', 167)" onmouseover="showTip(event, 'fs55', 167)" class="i">As</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 168)" onmouseover="showTip(event, 'fs46', 168)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs44', 169)" onmouseover="showTip(event, 'fs44', 169)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs38', 170)" onmouseover="showTip(event, 'fs38', 170)" class="i">matA</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs43', 171)" onmouseover="showTip(event, 'fs43', 171)" class="i">by</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 172)" onmouseover="showTip(event, 'fs36', 172)" class="i">BLOCK_SIZE</span>, <span onmouseout="hideTip(event, 'fs60', 173)" onmouseover="showTip(event, 'fs60', 173)" class="i">aCol</span>]
        <span onmouseout="hideTip(event, 'fs59', 174)" onmouseover="showTip(event, 'fs59', 174)" class="i">Bs</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 175)" onmouseover="showTip(event, 'fs46', 175)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs44', 176)" onmouseover="showTip(event, 'fs44', 176)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs39', 177)" onmouseover="showTip(event, 'fs39', 177)" class="i">matB</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs53', 178)" onmouseover="showTip(event, 'fs53', 178)" class="i">bRow</span>, <span onmouseout="hideTip(event, 'fs50', 179)" onmouseover="showTip(event, 'fs50', 179)" class="i">bCol</span>]
        <span onmouseout="hideTip(event, 'fs10', 180)" onmouseover="showTip(event, 'fs10', 180)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 181)" onmouseover="showTip(event, 'fs61', 181)" class="i">Barrier</span>(<span onmouseout="hideTip(event, 'fs62', 182)" onmouseover="showTip(event, 'fs62', 182)" class="i">CLK_LOCAL_MEM_FENCE</span>)
 
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs63', 183)" onmouseover="showTip(event, 'fs63', 183)" class="i">k</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs36', 184)" onmouseover="showTip(event, 'fs36', 184)" class="i">BLOCK_SIZE</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs54', 185)" onmouseover="showTip(event, 'fs54', 185)" class="i">Csub</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs54', 186)" onmouseover="showTip(event, 'fs54', 186)" class="i">Csub</span> <span class="o">+</span> (<span onmouseout="hideTip(event, 'fs55', 187)" onmouseover="showTip(event, 'fs55', 187)" class="i">As</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 188)" onmouseover="showTip(event, 'fs46', 188)" class="i">ty</span>,<span onmouseout="hideTip(event, 'fs63', 189)" onmouseover="showTip(event, 'fs63', 189)" class="i">k</span>] <span class="o">*</span> <span onmouseout="hideTip(event, 'fs59', 190)" onmouseover="showTip(event, 'fs59', 190)" class="i">Bs</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs63', 191)" onmouseover="showTip(event, 'fs63', 191)" class="i">k</span>,<span onmouseout="hideTip(event, 'fs44', 192)" onmouseover="showTip(event, 'fs44', 192)" class="i">tx</span>])
        <span onmouseout="hideTip(event, 'fs10', 193)" onmouseover="showTip(event, 'fs10', 193)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 194)" onmouseover="showTip(event, 'fs61', 194)" class="i">Barrier</span>(<span onmouseout="hideTip(event, 'fs62', 195)" onmouseover="showTip(event, 'fs62', 195)" class="i">CLK_LOCAL_MEM_FENCE</span>)

        <span onmouseout="hideTip(event, 'fs53', 196)" onmouseover="showTip(event, 'fs53', 196)" class="i">bRow</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs53', 197)" onmouseover="showTip(event, 'fs53', 197)" class="i">bRow</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs52', 198)" onmouseover="showTip(event, 'fs52', 198)" class="i">bStep</span>
    <span onmouseout="hideTip(event, 'fs40', 199)" onmouseover="showTip(event, 'fs40', 199)" class="i">matC</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs43', 200)" onmouseover="showTip(event, 'fs43', 200)" class="i">by</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 201)" onmouseover="showTip(event, 'fs36', 201)" class="i">BLOCK_SIZE</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs46', 202)" onmouseover="showTip(event, 'fs46', 202)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs41', 203)" onmouseover="showTip(event, 'fs41', 203)" class="i">bx</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 204)" onmouseover="showTip(event, 'fs36', 204)" class="i">BLOCK_SIZE</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs44', 205)" onmouseover="showTip(event, 'fs44', 205)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs54', 206)" onmouseover="showTip(event, 'fs54', 206)" class="i">Csub</span></pre>
</td>
</tr>
</table>

<p>In OpenCL there are two ways to share data among the threads in a group. The first is by declaring
local variables inside the kernel body as shown in the previous example, the second is by using parameters 
qualified with <em><em></em>local</em>. This last way allows to establish the size of the local data dynamically.</p>

<p>Parameter qualifiers are mapped to FSCL as .NET custom attributes. Given this, we may rewrite the example above,
lifting the local declarations from the kernel body and adding two local parameters as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 207)" onmouseover="showTip(event, 'fs4', 207)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 208)" onmouseover="showTip(event, 'fs64', 208)" class="i">MatrixMultWithLocalParam</span>(<span onmouseout="hideTip(event, 'fs38', 209)" onmouseover="showTip(event, 'fs38', 209)" class="i">matA</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 210)" onmouseover="showTip(event, 'fs7', 210)" class="i">float32</span>[,], 
                             <span onmouseout="hideTip(event, 'fs39', 211)" onmouseover="showTip(event, 'fs39', 211)" class="i">matB</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 212)" onmouseover="showTip(event, 'fs7', 212)" class="i">float32</span>[,], 
                             <span onmouseout="hideTip(event, 'fs40', 213)" onmouseover="showTip(event, 'fs40', 213)" class="i">matC</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 214)" onmouseover="showTip(event, 'fs7', 214)" class="i">float32</span>[,], 
                             [&lt;<span onmouseout="hideTip(event, 'fs65', 215)" onmouseover="showTip(event, 'fs65', 215)" class="i">AddressSpace</span>(<span onmouseout="hideTip(event, 'fs65', 216)" onmouseover="showTip(event, 'fs65', 216)" class="i">AddressSpace</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs66', 217)" onmouseover="showTip(event, 'fs66', 217)" class="i">Local</span>)&gt;]
                             <span onmouseout="hideTip(event, 'fs55', 218)" onmouseover="showTip(event, 'fs55', 218)" class="i">As</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 219)" onmouseover="showTip(event, 'fs7', 219)" class="i">float32</span>[,],
                             [&lt;<span onmouseout="hideTip(event, 'fs65', 220)" onmouseover="showTip(event, 'fs65', 220)" class="i">AddressSpace</span>(<span onmouseout="hideTip(event, 'fs65', 221)" onmouseover="showTip(event, 'fs65', 221)" class="i">AddressSpace</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs66', 222)" onmouseover="showTip(event, 'fs66', 222)" class="i">Local</span>)&gt;]
                             <span onmouseout="hideTip(event, 'fs59', 223)" onmouseover="showTip(event, 'fs59', 223)" class="i">Bs</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 224)" onmouseover="showTip(event, 'fs7', 224)" class="i">float32</span>[,],
                             <span onmouseout="hideTip(event, 'fs10', 225)" onmouseover="showTip(event, 'fs10', 225)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 226)" onmouseover="showTip(event, 'fs11', 226)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 227)" onmouseover="showTip(event, 'fs41', 227)" class="i">bx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 228)" onmouseover="showTip(event, 'fs10', 228)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 229)" onmouseover="showTip(event, 'fs42', 229)" class="i">GroupID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 230)" onmouseover="showTip(event, 'fs43', 230)" class="i">by</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 231)" onmouseover="showTip(event, 'fs10', 231)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 232)" onmouseover="showTip(event, 'fs42', 232)" class="i">GroupID</span>(<span class="n">1</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 233)" onmouseover="showTip(event, 'fs44', 233)" class="i">tx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 234)" onmouseover="showTip(event, 'fs10', 234)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 235)" onmouseover="showTip(event, 'fs45', 235)" class="i">LocalID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 236)" onmouseover="showTip(event, 'fs46', 236)" class="i">ty</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 237)" onmouseover="showTip(event, 'fs10', 237)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 238)" onmouseover="showTip(event, 'fs45', 238)" class="i">LocalID</span>(<span class="n">1</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 239)" onmouseover="showTip(event, 'fs47', 239)" class="i">wa</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 240)" onmouseover="showTip(event, 'fs38', 240)" class="i">matA</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 241)" onmouseover="showTip(event, 'fs48', 241)" class="i">GetLength</span>(<span class="n">0</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 242)" onmouseover="showTip(event, 'fs49', 242)" class="i">wb</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 243)" onmouseover="showTip(event, 'fs39', 243)" class="i">matB</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 244)" onmouseover="showTip(event, 'fs48', 244)" class="i">GetLength</span>(<span class="n">0</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 245)" onmouseover="showTip(event, 'fs50', 245)" class="i">bCol</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 246)" onmouseover="showTip(event, 'fs41', 246)" class="i">bx</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 247)" onmouseover="showTip(event, 'fs36', 247)" class="i">BLOCK_SIZE</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 248)" onmouseover="showTip(event, 'fs51', 248)" class="i">bBeginRow</span> <span class="o">=</span> <span class="n">0</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 249)" onmouseover="showTip(event, 'fs52', 249)" class="i">bStep</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 250)" onmouseover="showTip(event, 'fs36', 250)" class="i">BLOCK_SIZE</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs53', 251)" onmouseover="showTip(event, 'fs53', 251)" class="i">bRow</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs51', 252)" onmouseover="showTip(event, 'fs51', 252)" class="i">bBeginRow</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs54', 253)" onmouseover="showTip(event, 'fs54', 253)" class="i">Csub</span> <span class="o">=</span> <span class="n">0.0f</span>

    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs60', 254)" onmouseover="showTip(event, 'fs60', 254)" class="i">aCol</span> <span class="k">in</span> <span class="n">0</span> <span class="o">..</span> <span onmouseout="hideTip(event, 'fs36', 255)" onmouseover="showTip(event, 'fs36', 255)" class="i">BLOCK_SIZE</span> <span class="o">..</span> (<span onmouseout="hideTip(event, 'fs47', 256)" onmouseover="showTip(event, 'fs47', 256)" class="i">wa</span> <span class="o">-</span> <span class="n">1</span>) <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs55', 257)" onmouseover="showTip(event, 'fs55', 257)" class="i">As</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 258)" onmouseover="showTip(event, 'fs46', 258)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs44', 259)" onmouseover="showTip(event, 'fs44', 259)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs38', 260)" onmouseover="showTip(event, 'fs38', 260)" class="i">matA</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs43', 261)" onmouseover="showTip(event, 'fs43', 261)" class="i">by</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 262)" onmouseover="showTip(event, 'fs36', 262)" class="i">BLOCK_SIZE</span>, <span onmouseout="hideTip(event, 'fs60', 263)" onmouseover="showTip(event, 'fs60', 263)" class="i">aCol</span>]
        <span onmouseout="hideTip(event, 'fs59', 264)" onmouseover="showTip(event, 'fs59', 264)" class="i">Bs</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 265)" onmouseover="showTip(event, 'fs46', 265)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs44', 266)" onmouseover="showTip(event, 'fs44', 266)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs39', 267)" onmouseover="showTip(event, 'fs39', 267)" class="i">matB</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs53', 268)" onmouseover="showTip(event, 'fs53', 268)" class="i">bRow</span>, <span onmouseout="hideTip(event, 'fs50', 269)" onmouseover="showTip(event, 'fs50', 269)" class="i">bCol</span>]
        <span onmouseout="hideTip(event, 'fs10', 270)" onmouseover="showTip(event, 'fs10', 270)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 271)" onmouseover="showTip(event, 'fs61', 271)" class="i">Barrier</span>(<span onmouseout="hideTip(event, 'fs62', 272)" onmouseover="showTip(event, 'fs62', 272)" class="i">CLK_LOCAL_MEM_FENCE</span>)
 
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs63', 273)" onmouseover="showTip(event, 'fs63', 273)" class="i">k</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs36', 274)" onmouseover="showTip(event, 'fs36', 274)" class="i">BLOCK_SIZE</span> <span class="o">-</span> <span class="n">1</span> <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs54', 275)" onmouseover="showTip(event, 'fs54', 275)" class="i">Csub</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs54', 276)" onmouseover="showTip(event, 'fs54', 276)" class="i">Csub</span> <span class="o">+</span> (<span onmouseout="hideTip(event, 'fs55', 277)" onmouseover="showTip(event, 'fs55', 277)" class="i">As</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs46', 278)" onmouseover="showTip(event, 'fs46', 278)" class="i">ty</span>,<span onmouseout="hideTip(event, 'fs63', 279)" onmouseover="showTip(event, 'fs63', 279)" class="i">k</span>] <span class="o">*</span> <span onmouseout="hideTip(event, 'fs59', 280)" onmouseover="showTip(event, 'fs59', 280)" class="i">Bs</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs63', 281)" onmouseover="showTip(event, 'fs63', 281)" class="i">k</span>,<span onmouseout="hideTip(event, 'fs44', 282)" onmouseover="showTip(event, 'fs44', 282)" class="i">tx</span>])
        <span onmouseout="hideTip(event, 'fs10', 283)" onmouseover="showTip(event, 'fs10', 283)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 284)" onmouseover="showTip(event, 'fs61', 284)" class="i">Barrier</span>(<span onmouseout="hideTip(event, 'fs62', 285)" onmouseover="showTip(event, 'fs62', 285)" class="i">CLK_LOCAL_MEM_FENCE</span>)

        <span onmouseout="hideTip(event, 'fs53', 286)" onmouseover="showTip(event, 'fs53', 286)" class="i">bRow</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs53', 287)" onmouseover="showTip(event, 'fs53', 287)" class="i">bRow</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs52', 288)" onmouseover="showTip(event, 'fs52', 288)" class="i">bStep</span>
    <span onmouseout="hideTip(event, 'fs40', 289)" onmouseover="showTip(event, 'fs40', 289)" class="i">matC</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs43', 290)" onmouseover="showTip(event, 'fs43', 290)" class="i">by</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 291)" onmouseover="showTip(event, 'fs36', 291)" class="i">BLOCK_SIZE</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs46', 292)" onmouseover="showTip(event, 'fs46', 292)" class="i">ty</span>, <span onmouseout="hideTip(event, 'fs41', 293)" onmouseover="showTip(event, 'fs41', 293)" class="i">bx</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs36', 294)" onmouseover="showTip(event, 'fs36', 294)" class="i">BLOCK_SIZE</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs44', 295)" onmouseover="showTip(event, 'fs44', 295)" class="i">tx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs54', 296)" onmouseover="showTip(event, 'fs54', 296)" class="i">Csub</span></pre>
</td>
</tr>
</table>

<p>The attribute <code>AddressSpace</code> is only one of the many provided by FSCL to add meta-information to kernels and kernel parameters.
For additional information about them, see <a href="dynamicMetadataTutorial.html">Dynamic Metadata Tutorial</a>.</p>

<h3>High-level constructs example: Vector Addition with return type</h3>

<p>While enabling to code "classic" OpenCL kernels in F#, FSCL gives the chance to employ additional .NET/F# programming
constructs and data-types that are generally not supported in OpenCL.</p>

<p>The most important, especially from the <a href="http://nuget.org/FSCL.Runtime">kernel composition</a> point of view, is the 
ability for and FSCL kernel to return a value.
In OpenCL, kernels are forced to return <em>void</em>, which is a constrain respected in all the previous examples. 
Nevertheless, the FSCL compiler is able to transform kernel returning non-void values into legal OpenCL kernels, replacing the returned
variable (it must be a variable) with an additional kernel parameter whose purpose is to be a container for the output data.</p>

<p>We can exploit this feature and rewrite our first example. The following code shows the two versions of the vector addition kernel, semantically equivalent, 
where the second is employing the FSCL kernel-return-types feature.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Classic OpenCL vector addition</span>
[&lt;<span onmouseout="hideTip(event, 'fs4', 297)" onmouseover="showTip(event, 'fs4', 297)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs67', 298)" onmouseover="showTip(event, 'fs67', 298)" class="i">VectorAddNoReturn</span>(<span onmouseout="hideTip(event, 'fs6', 299)" onmouseover="showTip(event, 'fs6', 299)" class="i">a</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 300)" onmouseover="showTip(event, 'fs7', 300)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs8', 301)" onmouseover="showTip(event, 'fs8', 301)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 302)" onmouseover="showTip(event, 'fs7', 302)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs9', 303)" onmouseover="showTip(event, 'fs9', 303)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 304)" onmouseover="showTip(event, 'fs7', 304)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 305)" onmouseover="showTip(event, 'fs10', 305)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 306)" onmouseover="showTip(event, 'fs11', 306)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 307)" onmouseover="showTip(event, 'fs12', 307)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 308)" onmouseover="showTip(event, 'fs10', 308)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 309)" onmouseover="showTip(event, 'fs13', 309)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs9', 310)" onmouseover="showTip(event, 'fs9', 310)" class="i">c</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 311)" onmouseover="showTip(event, 'fs12', 311)" class="i">myId</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs6', 312)" onmouseover="showTip(event, 'fs6', 312)" class="i">a</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 313)" onmouseover="showTip(event, 'fs12', 313)" class="i">myId</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs8', 314)" onmouseover="showTip(event, 'fs8', 314)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 315)" onmouseover="showTip(event, 'fs12', 315)" class="i">myId</span>]

<span class="c">// Vector addition with return type</span>
[&lt;<span onmouseout="hideTip(event, 'fs4', 316)" onmouseover="showTip(event, 'fs4', 316)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 317)" onmouseover="showTip(event, 'fs68', 317)" class="i">VectorAddWithReturn</span>(<span onmouseout="hideTip(event, 'fs6', 318)" onmouseover="showTip(event, 'fs6', 318)" class="i">a</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 319)" onmouseover="showTip(event, 'fs7', 319)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs8', 320)" onmouseover="showTip(event, 'fs8', 320)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 321)" onmouseover="showTip(event, 'fs7', 321)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 322)" onmouseover="showTip(event, 'fs10', 322)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 323)" onmouseover="showTip(event, 'fs11', 323)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 324)" onmouseover="showTip(event, 'fs9', 324)" class="i">c</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs69', 325)" onmouseover="showTip(event, 'fs69', 325)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 326)" onmouseover="showTip(event, 'fs70', 326)" class="i">zeroCreate</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs7', 327)" onmouseover="showTip(event, 'fs7', 327)" class="i">float32</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs6', 328)" onmouseover="showTip(event, 'fs6', 328)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 329)" onmouseover="showTip(event, 'fs71', 329)" class="i">Length</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 330)" onmouseover="showTip(event, 'fs12', 330)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 331)" onmouseover="showTip(event, 'fs10', 331)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 332)" onmouseover="showTip(event, 'fs13', 332)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs9', 333)" onmouseover="showTip(event, 'fs9', 333)" class="i">c</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 334)" onmouseover="showTip(event, 'fs12', 334)" class="i">myId</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs6', 335)" onmouseover="showTip(event, 'fs6', 335)" class="i">a</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 336)" onmouseover="showTip(event, 'fs12', 336)" class="i">myId</span>] <span class="o">+</span> <span onmouseout="hideTip(event, 'fs8', 337)" onmouseover="showTip(event, 'fs8', 337)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 338)" onmouseover="showTip(event, 'fs12', 338)" class="i">myId</span>]

    <span onmouseout="hideTip(event, 'fs9', 339)" onmouseover="showTip(event, 'fs9', 339)" class="i">c</span></pre>
</td>
</tr>
</table>

<p>FSCL is supporting other kind of high-level constructs and data-types, such as <em>structs</em>, <em>records</em> and <em>reference cells</em>.
Reference cells are particularly interesting (and expressive) whenever a kernel output is a singleton (1-element) array.
For example, consider a kernel that executes a computation and eventually produces a scalar value as output. Generally,
the task of writing this value to the output buffer is performed by a specific thread (often the first one), so that
the kernel code looks like the following.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 340)" onmouseover="showTip(event, 'fs4', 340)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 341)" onmouseover="showTip(event, 'fs72', 341)" class="i">MyKernelWithArray</span>(<span onmouseout="hideTip(event, 'fs73', 342)" onmouseover="showTip(event, 'fs73', 342)" class="i">input</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 343)" onmouseover="showTip(event, 'fs7', 343)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs74', 344)" onmouseover="showTip(event, 'fs74', 344)" class="i">output</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 345)" onmouseover="showTip(event, 'fs7', 345)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 346)" onmouseover="showTip(event, 'fs10', 346)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 347)" onmouseover="showTip(event, 'fs11', 347)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 348)" onmouseover="showTip(event, 'fs12', 348)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 349)" onmouseover="showTip(event, 'fs10', 349)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 350)" onmouseover="showTip(event, 'fs13', 350)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs75', 351)" onmouseover="showTip(event, 'fs75', 351)" class="i">resultToWrite</span> <span class="o">=</span> <span class="n">0.0f</span>
    <span class="c">// Do some calculation and compute resultToWrite</span>
    <span class="c">// ...</span>

    <span class="c">// If I&#39;m the first thread then write to the output</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs12', 352)" onmouseover="showTip(event, 'fs12', 352)" class="i">myId</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs74', 353)" onmouseover="showTip(event, 'fs74', 353)" class="i">output</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs75', 354)" onmouseover="showTip(event, 'fs75', 354)" class="i">resultToWrite</span> </pre>
</td>
</tr>
</table>

<p>In such a case, you can use a reference cell in place of the output array, as shown below.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 355)" onmouseover="showTip(event, 'fs4', 355)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 356)" onmouseover="showTip(event, 'fs76', 356)" class="i">MyKernelWithRefVar</span>(<span onmouseout="hideTip(event, 'fs73', 357)" onmouseover="showTip(event, 'fs73', 357)" class="i">input</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 358)" onmouseover="showTip(event, 'fs7', 358)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs77', 359)" onmouseover="showTip(event, 'fs77', 359)" class="i">output</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 360)" onmouseover="showTip(event, 'fs7', 360)" class="i">float32</span> <span onmouseout="hideTip(event, 'fs78', 361)" onmouseover="showTip(event, 'fs78', 361)" class="i">ref</span>, <span onmouseout="hideTip(event, 'fs10', 362)" onmouseover="showTip(event, 'fs10', 362)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 363)" onmouseover="showTip(event, 'fs11', 363)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 364)" onmouseover="showTip(event, 'fs12', 364)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 365)" onmouseover="showTip(event, 'fs10', 365)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 366)" onmouseover="showTip(event, 'fs13', 366)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs75', 367)" onmouseover="showTip(event, 'fs75', 367)" class="i">resultToWrite</span> <span class="o">=</span> <span class="n">0.0f</span>
    <span class="c">// Do some calculation and compute resultToWrite</span>
    <span class="c">// ...</span>

    <span class="c">// If I&#39;m the first thread then write to the output</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs12', 368)" onmouseover="showTip(event, 'fs12', 368)" class="i">myId</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs77', 369)" onmouseover="showTip(event, 'fs77', 369)" class="i">output</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs75', 370)" onmouseover="showTip(event, 'fs75', 370)" class="i">resultToWrite</span> </pre>
</td>
</tr>
</table>

<h3>Utility functions</h3>

<p>When programming a kernel, you're not fored to encapsulate the whole code in a single kernel. Kernels can leverage on 
utility functions to performs some computations or well defined tasks.
For example, in the vector addition sample we may put the operation to be applied to the matching elements of the two input arrays in a separate function.
The OpenCL source produced will contain both the kernel and the utility function definitions.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span onmouseout="hideTip(event, 'fs4', 371)" onmouseover="showTip(event, 'fs4', 371)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 372)" onmouseover="showTip(event, 'fs79', 372)" class="i">op</span> <span onmouseout="hideTip(event, 'fs80', 373)" onmouseover="showTip(event, 'fs80', 373)" class="i">a</span> <span onmouseout="hideTip(event, 'fs81', 374)" onmouseover="showTip(event, 'fs81', 374)" class="i">b</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs80', 375)" onmouseover="showTip(event, 'fs80', 375)" class="i">a</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs81', 376)" onmouseover="showTip(event, 'fs81', 376)" class="i">b</span>

[&lt;<span onmouseout="hideTip(event, 'fs4', 377)" onmouseover="showTip(event, 'fs4', 377)" class="i">ReflectedDefinition</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs82', 378)" onmouseover="showTip(event, 'fs82', 378)" class="i">VectorAddWithUtilityFunction</span>(<span onmouseout="hideTip(event, 'fs6', 379)" onmouseover="showTip(event, 'fs6', 379)" class="i">a</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 380)" onmouseover="showTip(event, 'fs7', 380)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs8', 381)" onmouseover="showTip(event, 'fs8', 381)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 382)" onmouseover="showTip(event, 'fs7', 382)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs9', 383)" onmouseover="showTip(event, 'fs9', 383)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 384)" onmouseover="showTip(event, 'fs7', 384)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 385)" onmouseover="showTip(event, 'fs10', 385)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 386)" onmouseover="showTip(event, 'fs11', 386)" class="i">WorkItemInfo</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 387)" onmouseover="showTip(event, 'fs12', 387)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 388)" onmouseover="showTip(event, 'fs10', 388)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 389)" onmouseover="showTip(event, 'fs13', 389)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs9', 390)" onmouseover="showTip(event, 'fs9', 390)" class="i">c</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 391)" onmouseover="showTip(event, 'fs12', 391)" class="i">myId</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs79', 392)" onmouseover="showTip(event, 'fs79', 392)" class="i">op</span> <span onmouseout="hideTip(event, 'fs6', 393)" onmouseover="showTip(event, 'fs6', 393)" class="i">a</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 394)" onmouseover="showTip(event, 'fs12', 394)" class="i">myId</span>] <span onmouseout="hideTip(event, 'fs8', 395)" onmouseover="showTip(event, 'fs8', 395)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 396)" onmouseover="showTip(event, 'fs12', 396)" class="i">myId</span>]</pre>
</td>
</tr>
</table>

<h3>FSCL kernels as lambdas</h3>

<p>FSCL kernels can be also expressed using the lambdas. For example, instad of defining a function, we may write the vector addition kernel as follows.
While the FSCL Compiler is still able to produce the appropriate kernel code in such a case, this time the name of the kernel in the OpenCL source produced
is automatically generated (it is no more <em>VectorAdd</em> ).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs6', 397)" onmouseover="showTip(event, 'fs6', 397)" class="i">a</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 398)" onmouseover="showTip(event, 'fs7', 398)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs8', 399)" onmouseover="showTip(event, 'fs8', 399)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 400)" onmouseover="showTip(event, 'fs7', 400)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs9', 401)" onmouseover="showTip(event, 'fs9', 401)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 402)" onmouseover="showTip(event, 'fs7', 402)" class="i">float32</span>[], <span onmouseout="hideTip(event, 'fs10', 403)" onmouseover="showTip(event, 'fs10', 403)" class="i">wi</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 404)" onmouseover="showTip(event, 'fs11', 404)" class="i">WorkItemInfo</span>) <span class="k">-&gt;</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 405)" onmouseover="showTip(event, 'fs12', 405)" class="i">myId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 406)" onmouseover="showTip(event, 'fs10', 406)" class="i">wi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 407)" onmouseover="showTip(event, 'fs13', 407)" class="i">GlobalID</span>(<span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs9', 408)" onmouseover="showTip(event, 'fs9', 408)" class="i">c</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 409)" onmouseover="showTip(event, 'fs12', 409)" class="i">myId</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs79', 410)" onmouseover="showTip(event, 'fs79', 410)" class="i">op</span> <span onmouseout="hideTip(event, 'fs6', 411)" onmouseover="showTip(event, 'fs6', 411)" class="i">a</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 412)" onmouseover="showTip(event, 'fs12', 412)" class="i">myId</span>] <span onmouseout="hideTip(event, 'fs8', 413)" onmouseover="showTip(event, 'fs8', 413)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs12', 414)" onmouseover="showTip(event, 'fs12', 414)" class="i">myId</span>]</pre>
</td>
</tr>
</table>

<h3>Using collection functions</h3>

<p>In addition to custom FSCL kernels, programmers can compile to OpenCL references and calls to <code>Array</code> collection functions, such as <code>Array.sum</code>, <code>Array.map2</code> and <code>Array.reduce</code>. 
In such a case, the kernel code is not specified by the programmer but produced automatically by the compiler given the intrinsic semantic of those functions. 
For more information about the kernel source produced from collection functions, see <a href="compilerInterfaceTutorial.html">Compiler Interface Tutorial</a>.</p>

<div class="tip" id="fs1">namespace FSCL</div>
<div class="tip" id="fs2">namespace FSCL.Compiler</div>
<div class="tip" id="fs3">module Language<br /><br />from FSCL</div>
<div class="tip" id="fs4">Multiple items<br />type ReflectedDefinitionAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; ReflectedDefinitionAttribute<br /><br />Full name: Microsoft.FSharp.Core.ReflectedDefinitionAttribute<br /><br />--------------------<br />new : unit -&gt; ReflectedDefinitionAttribute</div>
<div class="tip" id="fs5">val VectorAdd : a:float32 [] * b:float32 [] * c:float32 [] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.VectorAdd</div>
<div class="tip" id="fs6">val a : float32 []</div>
<div class="tip" id="fs7">Multiple items<br />val float32 : value:&#39;T -&gt; float32 (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float32<br /><br />--------------------<br />type float32 = System.Single<br /><br />Full name: Microsoft.FSharp.Core.float32<br /><br />--------------------<br />type float32&lt;&#39;Measure&gt; = float32<br /><br />Full name: Microsoft.FSharp.Core.float32&lt;_&gt;</div>
<div class="tip" id="fs8">val b : float32 []</div>
<div class="tip" id="fs9">val c : float32 []</div>
<div class="tip" id="fs10">val wi : WorkItemInfo</div>
<div class="tip" id="fs11">type WorkItemInfo =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;abstract member Barrier : MemFenceMode -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member GlobalID : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member GlobalOffset : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member GlobalSize : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member GroupID : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member LocalID : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member LocalSize : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member NumGroups : int -&gt; int<br />&#160;&#160;&#160;&#160;abstract member WorkDim : unit -&gt; int<br />&#160;&#160;end<br /><br />Full name: FSCL.Language.WorkItemInfo</div>
<div class="tip" id="fs12">val myId : int</div>
<div class="tip" id="fs13">abstract member WorkItemInfo.GlobalID : int -&gt; int</div>
<div class="tip" id="fs14">val SobelFilter2D : inputImage:uchar4 [,] * outputImage:uchar4 [,] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.SobelFilter2D</div>
<div class="tip" id="fs15">val inputImage : uchar4 [,]</div>
<div class="tip" id="fs16">Multiple items<br />type uchar4 =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;private new : c:byte [] -&gt; uchar4<br />&#160;&#160;&#160;&#160;new : v:byte -&gt; uchar4<br />&#160;&#160;&#160;&#160;new : X:byte * Y:byte * Z:byte * W:byte -&gt; uchar4<br />&#160;&#160;&#160;&#160;val mutable x: byte<br />&#160;&#160;&#160;&#160;val mutable y: byte<br />&#160;&#160;&#160;&#160;val mutable z: byte<br />&#160;&#160;&#160;&#160;val mutable w: byte<br />&#160;&#160;&#160;&#160;member Components : byte []<br />&#160;&#160;&#160;&#160;member even : uchar2<br />&#160;&#160;&#160;&#160;member hi : uchar2<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: FSCL.uchar4<br /><br />--------------------<br />uchar4()<br />new : v:byte -&gt; uchar4<br />new : X:byte * Y:byte * Z:byte * W:byte -&gt; uchar4</div>
<div class="tip" id="fs17">val outputImage : uchar4 [,]</div>
<div class="tip" id="fs18">val x : int</div>
<div class="tip" id="fs19">val y : int</div>
<div class="tip" id="fs20">val width : int</div>
<div class="tip" id="fs21">abstract member WorkItemInfo.GlobalSize : int -&gt; int</div>
<div class="tip" id="fs22">val height : int</div>
<div class="tip" id="fs23">val mutable Gx : float4</div>
<div class="tip" id="fs24">Multiple items<br />type float4 =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;private new : c:float32 [] -&gt; float4<br />&#160;&#160;&#160;&#160;new : v:float32 -&gt; float4<br />&#160;&#160;&#160;&#160;new : X:float32 * Y:float32 * Z:float32 * W:float32 -&gt; float4<br />&#160;&#160;&#160;&#160;val mutable x: float32<br />&#160;&#160;&#160;&#160;val mutable y: float32<br />&#160;&#160;&#160;&#160;val mutable z: float32<br />&#160;&#160;&#160;&#160;val mutable w: float32<br />&#160;&#160;&#160;&#160;member Components : float32 []<br />&#160;&#160;&#160;&#160;member even : float2<br />&#160;&#160;&#160;&#160;member hi : float2<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: FSCL.float4<br /><br />--------------------<br />float4()<br />new : v:float32 -&gt; float4<br />new : X:float32 * Y:float32 * Z:float32 * W:float32 -&gt; float4</div>
<div class="tip" id="fs25">val mutable Gy : float4</div>
<div class="tip" id="fs26">val i00 : float4</div>
<div class="tip" id="fs27">val i10 : float4</div>
<div class="tip" id="fs28">val i20 : float4</div>
<div class="tip" id="fs29">val i01 : float4</div>
<div class="tip" id="fs30">val i11 : float4</div>
<div class="tip" id="fs31">val i21 : float4</div>
<div class="tip" id="fs32">val i02 : float4</div>
<div class="tip" id="fs33">val i12 : float4</div>
<div class="tip" id="fs34">val i22 : float4</div>
<div class="tip" id="fs35">static member float4.hypot : a:float4 * b:float4 -&gt; float4</div>
<div class="tip" id="fs36">val BLOCK_SIZE : int<br /><br />Full name: KernelProgrammingTutorial.BLOCK_SIZE</div>
<div class="tip" id="fs37">val MatrixMult : matA:float32 [,] * matB:float32 [,] * matC:float32 [,] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.MatrixMult</div>
<div class="tip" id="fs38">val matA : float32 [,]</div>
<div class="tip" id="fs39">val matB : float32 [,]</div>
<div class="tip" id="fs40">val matC : float32 [,]</div>
<div class="tip" id="fs41">val bx : int</div>
<div class="tip" id="fs42">abstract member WorkItemInfo.GroupID : int -&gt; int</div>
<div class="tip" id="fs43">val by : int</div>
<div class="tip" id="fs44">val tx : int</div>
<div class="tip" id="fs45">abstract member WorkItemInfo.LocalID : int -&gt; int</div>
<div class="tip" id="fs46">val ty : int</div>
<div class="tip" id="fs47">val wa : int</div>
<div class="tip" id="fs48">System.Array.GetLength(dimension: int) : int</div>
<div class="tip" id="fs49">val wb : int</div>
<div class="tip" id="fs50">val bCol : int</div>
<div class="tip" id="fs51">val bBeginRow : int</div>
<div class="tip" id="fs52">val bStep : int</div>
<div class="tip" id="fs53">val mutable bRow : int</div>
<div class="tip" id="fs54">val mutable Csub : float32</div>
<div class="tip" id="fs55">val As : float32 [,]</div>
<div class="tip" id="fs56">val local : a:&#39;a -&gt; &#39;a<br /><br />Full name: FSCL.Language.local</div>
<div class="tip" id="fs57">module Array2D<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs58">val zeroCreate : length1:int -&gt; length2:int -&gt; &#39;T [,]<br /><br />Full name: Microsoft.FSharp.Collections.Array2D.zeroCreate</div>
<div class="tip" id="fs59">val Bs : float32 [,]</div>
<div class="tip" id="fs60">val aCol : int</div>
<div class="tip" id="fs61">abstract member WorkItemInfo.Barrier : MemFenceMode -&gt; unit</div>
<div class="tip" id="fs62">union case MemFenceMode.CLK_LOCAL_MEM_FENCE: MemFenceMode</div>
<div class="tip" id="fs63">val k : int</div>
<div class="tip" id="fs64">val MatrixMultWithLocalParam : matA:float32 [,] * matB:float32 [,] * matC:float32 [,] * As:float32 [,] * Bs:float32 [,] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.MatrixMultWithLocalParam</div>
<div class="tip" id="fs65">Multiple items<br />type AddressSpace =<br />&#160;&#160;|  Global  =  1<br />&#160;&#160;|  Constant  =  2<br />&#160;&#160;|  Local  =  4<br />&#160;&#160;|  Private  =  8<br />&#160;&#160;|  Auto  =  0<br /><br />Full name: FSCL.Language.AddressSpace<br /><br />--------------------<br />type AddressSpaceAttribute =<br />&#160;&#160;inherit ParameterMetadataAttribute<br />&#160;&#160;new : unit -&gt; AddressSpaceAttribute<br />&#160;&#160;new : space:AddressSpace -&gt; AddressSpaceAttribute<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member AddressSpace : AddressSpace<br /><br />Full name: FSCL.Language.AddressSpaceAttribute<br /><br />--------------------<br />new : unit -&gt; AddressSpaceAttribute<br />new : space:AddressSpace -&gt; AddressSpaceAttribute</div>
<div class="tip" id="fs66">AddressSpace.Local: AddressSpace = 4</div>
<div class="tip" id="fs67">val VectorAddNoReturn : a:float32 [] * b:float32 [] * c:float32 [] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.VectorAddNoReturn</div>
<div class="tip" id="fs68">val VectorAddWithReturn : a:float32 [] * b:float32 [] * wi:WorkItemInfo -&gt; float32 []<br /><br />Full name: KernelProgrammingTutorial.VectorAddWithReturn</div>
<div class="tip" id="fs69">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs70">val zeroCreate : count:int -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.zeroCreate</div>
<div class="tip" id="fs71">property System.Array.Length: int</div>
<div class="tip" id="fs72">val MyKernelWithArray : input:float32 [] * output:float32 [] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.MyKernelWithArray</div>
<div class="tip" id="fs73">val input : float32 []</div>
<div class="tip" id="fs74">val output : float32 []</div>
<div class="tip" id="fs75">val mutable resultToWrite : float32</div>
<div class="tip" id="fs76">val MyKernelWithRefVar : input:float32 [] * output:float32 ref * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.MyKernelWithRefVar</div>
<div class="tip" id="fs77">val output : float32 ref</div>
<div class="tip" id="fs78">Multiple items<br />val ref : value:&#39;T -&gt; &#39;T ref<br /><br />Full name: Microsoft.FSharp.Core.Operators.ref<br /><br />--------------------<br />type &#39;T ref = Ref&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.ref&lt;_&gt;</div>
<div class="tip" id="fs79">val op : a:float32 -&gt; b:float32 -&gt; float32<br /><br />Full name: KernelProgrammingTutorial.op</div>
<div class="tip" id="fs80">val a : float32</div>
<div class="tip" id="fs81">val b : float32</div>
<div class="tip" id="fs82">val VectorAddWithUtilityFunction : a:float32 [] * b:float32 [] * c:float32 [] * wi:WorkItemInfo -&gt; unit<br /><br />Full name: KernelProgrammingTutorial.VectorAddWithUtilityFunction</div>

        </section>
        <footer>
            <p>This project is maintained by <a href="http://github.com/FSCL">Gabriele Cocco</a></p>
        </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
</body>
</html>
